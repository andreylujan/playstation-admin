<div class="page page-dashboard">

	<div class="overlay" ng-show="page.loader.show">
		<div style="position:absolute;top: 50%;left:50%;transform: translate(-50%, -50%);">
			<div>
				<p><strong>Descargando archivo...</strong></p>
				<p class="text-center">
					<img src="images/loader.gif" alt="loader" class="size-45x45">
				</p>
			</div>
		</div>
	</div>
	<div class="pageheader">

		<h2>{{page.title}}</h2>

		<div class="row">
			<div class="col-md-12">
				<a id="excelBtn" ng-href="" class="bg-blue-ps-2 btn-border pt-7 pb-7 pr-12 pl-12 br-10 b-0 text-white pull-right" uib-tooltip="Descargar resumen (.xls)" ng-click="getExcel({success:true,detail:'OK'})" ng-class="{disabled:page.buttons.getExcel.disabled,pointer:!page.buttons.getExcel.disabled}"><i class="fa fa-file-excel-o"></i> </a>
			</div>
		</div>

		<div class="row">
			<div class="col-md-2 mt-5">
				<ui-select class="gray-ps-3 br-15 b-0" ng-model="page.filters.zone.selected" close-on-select="true" ng-change="getDealers({success:true,detail:'OK'},page.filters.zone.selected);getDashboardInfo({success:true,detail:'OK'})" title="Zonas">
					<ui-select-match placeholder="Seleccionar zona..."><span ng-bind="$select.selected.name  | capitalize:true"></span></ui-select-match>
					<ui-select-choices repeat="zone in page.filters.zone.list | propsFilter: {name: $select.search}">
						<div ng-bind-html="zone.name | highlight: $select.search | capitalize:true"></div>
					</ui-select-choices>
				</ui-select>
			</div>
			<div class="col-md-2 mt-5">
				<ui-select class="blue-ps-1 br-15 b-0" ng-model="page.filters.dealer.selected" close-on-select="true" ng-change="getStores({success:true,detail:'OK'},page.filters.zone.selected,page.filters.dealer.selected);getDashboardInfo({success:true,detail:'OK'})" ng-disabled="page.filters.dealer.disabled" title="Dealers">
					<ui-select-match placeholder="Seleccionar dealer..."><span ng-bind="$select.selected.name | capitalize:true"></span></ui-select-match>
					<ui-select-choices repeat="dealer in page.filters.dealer.list | propsFilter: {name: $select.search}">
						<div ng-bind-html="dealer.name | highlight: $select.search | capitalize:true"></div>
					</ui-select-choices>
				</ui-select>
			</div>
			<div class="col-md-2 mt-5">
				<ui-select class="blue-ps-2 br-15 b-0" ng-model="page.filters.store.selected" sortable="true" close-on-select="true" ng-disabled="page.filters.store.disabled" ng-change="getDashboardInfo({success:true,detail:'OK'})" title="Tiendas">
					<ui-select-match placeholder="Seleccionar tienda..."><span ng-bind="$select.selected.name | capitalize:true"></span></ui-select-match>
					<ui-select-choices repeat="store in page.filters.store.list | propsFilter: {name: $select.search}">
						<div ng-bind-html="store.name | highlight: $select.search | capitalize:true"></div>
					</ui-select-choices>
				</ui-select>
			</div>
			<div class="col-md-2 mt-5">
				<ui-select class="gray-ps-2 br-15 b-0" ng-model="page.filters.instructor.selected" close-on-select="true" ng-disabled="page.filters.instructor.disabled" ng-change="getDashboardInfo({success:true,detail:'OK'})" title="Instructores">
					<ui-select-match placeholder="Seleccionar instructor..."><span ng-bind="$select.selected.name | capitalize:true"></span></ui-select-match>
					<ui-select-choices repeat="user in page.filters.instructor.list | propsFilter: {name: $select.search}">
						<div ng-bind-html="user.name | highlight: $select.search | capitalize:true"></div>
					</ui-select-choices>
				</ui-select>
			</div>
			<div class="col-md-2 mt-5">
				<ui-select class="gray-ps-1 br-15 b-0" ng-model="page.filters.supervisor.selected" close-on-select="true" ng-disabled="page.filters.supervisor.disabled" ng-change="getDashboardInfo({success:true,detail:'OK'})" title="Supervisores">
					<ui-select-match placeholder="Seleccionar supervisor..."><span ng-bind="$select.selected.name | capitalize:true"></span></ui-select-match>
					<ui-select-choices repeat="user in page.filters.supervisor.list | propsFilter: {name: $select.search}">
						<div ng-bind-html="user.name | highlight: $select.search | capitalize:true"></div>
					</ui-select-choices>
				</ui-select>
			</div>
			<div class="col-md-2 mt-5">
				<div class="input-group">
					<!-- <button id="daterangeDashStock" class="bg-gray-ps-1 pt-7 pb-7 pr-12 pl-12 br-15 b-0 text-white" daterangepicker="page.filters.dateRange.options" date-begin="page.filters.dateRange.startDate" date-end="page.filters.dateRange.endDate">
						<i class="fa fa-calendar"></i>&nbsp;&nbsp;<span>{{page.filters.dateRange.startDate | date: 'dd/MM/yyyy'}} - {{page.filters.dateRange.endDate | date: 'dd/MM/yyyy'}}</span>&nbsp;&nbsp;<i class="fa fa-angle-down"></i>
					</button> -->
					<input style="cursor:pointer" id="daterangeDashGoals2" date-range-picker class="bg-gray-ps-1 br-15 text-sm form-control b-0 date-picker" type="text" ng-model="page.filters.dateRange.date" options="page.filters.dateRange.options" />
				</div>
			</div>
		</div>
	</div>
	<div class="row">
		<div class="col-md-12">
			<section class="tile" fullscreen="isFullscreen01">
				<div class="tile-header dvd dvd-btm">
					<h1 class="custom-font"><strong>Stock por categoria</strong></h1>
				</div>
				<div class="tile-widget">
				<div class="row">
					<div class="col-md-2">
						<button class="bg-blue-ps-1 pt-7 pb-7 pr-12 pl-12 br-15 b-0 text-white ml-20 mb-10" ng-click="openModalStock()" uib-tooltip="Cargar Stock"><i class="fa fa-cloud-upload"></i> </button>
					</div>
				</div>
				<div class="row">
					<div class="col-md-3 mt-5">
						<ui-select class="gray-ps-3 br-15 b-0" ng-model="page.filters.zone_second.selected" close-on-select="true" ng-change="getDealersSecond({success:true,detail:'OK'},page.filters.zone_second.selected);getDashboardStock({success:true,detail:'OK'})" title="Zonas">
							<ui-select-match placeholder="Seleccionar zona..."><span ng-bind="$select.selected.name  | capitalize:true"></span></ui-select-match>
							<ui-select-choices repeat="zone_second in page.filters.zone_second.list | propsFilter: {name: $select.search}">
								<div ng-bind-html="zone_second.name | highlight: $select.search | capitalize:true"></div>
							</ui-select-choices>
						</ui-select>
					</div>
					<div class="col-md-3 mt-5">
						<ui-select class="blue-ps-1 br-15 b-0" ng-model="page.filters.dealer_second.selected" close-on-select="true" ng-change="getStoresSecond({success:true,detail:'OK'},page.filters.zone.selected,page.filters.dealer_second.selected);getDashboardStock({success:true,detail:'OK'})" ng-disabled="page.filters.dealer_second.disabled" title="Dealers">
							<ui-select-match placeholder="Seleccionar dealer..."><span ng-bind="$select.selected.name | capitalize:true"></span></ui-select-match>
							<ui-select-choices repeat="dealer_second in page.filters.dealer_second.list | propsFilter: {name: $select.search}">
								<div ng-bind-html="dealer_second.name | highlight: $select.search | capitalize:true"></div>
							</ui-select-choices>
						</ui-select>
					</div>
					<div class="col-md-3 mt-5">
						<ui-select class="blue-ps-2 br-15 b-0" ng-model="page.filters.store_second.selected" sortable="true" close-on-select="true" ng-disabled="page.filters.store_second.disabled" ng-change="getDashboardStock({success:true,detail:'OK'})" title="Tiendas">
							<ui-select-match placeholder="Seleccionar tienda..."><span ng-bind="$select.selected.name | capitalize:true"></span></ui-select-match>
							<ui-select-choices repeat="store_second in page.filters.store_second.list | propsFilter: {name: $select.search}">
								<div ng-bind-html="store_second.name | highlight: $select.search | capitalize:true"></div>
							</ui-select-choices>
						</ui-select>
					</div>
					<div class="col-md-3 mt-5">
						<div class="input-group">
							<input type="text" class="form-control" uib-datepicker-popup="dd/MM/yyyy" ng-model="page.filters.dateRange.date.selected_second" is-open="asd" datepicker-options="{minMode: 'day', showButtonBar: false, showWeek: false}"  ng-change="getDashboardStock({success: true,detail: 'OK'})"/>
							<span class="input-group-btn">
								<button type="button" class="btn btn-default" ng-click="asd = !asd"><i class="glyphicon glyphicon-calendar"></i></button>
							</span>
						</div>
					</div>
				</div>
				<br>
				<div class="row">
					<highchart config="page.stock_graph.chartConfig" ng-show="page.stock_graph.chartConfig.xAxis.categories.length"></highchart>
				</div>
			</section>
		</div>
	</div>
	<div class="row">
		<div class="col-md-12">
			<section class="tile" fullscreen="isFullscreen01">
				<div class="tile-header dvd dvd-btm">
					<h1 class="custom-font text-red"><strong>Quiebre de Stock</strong></h1>
				</div>
				<div class="tile-widget">
					<table ng-table="page.stock.stockBreaks.tableParams" show-filter="true" class="table table-custom" >
						<tr ng-repeat="stockBreak in $data" ng-show="page.stock.stockBreaks.tableParams.data.length">
							<td data-title="'Dealer'" sortable="'dealerName'" filter="{'dealerName': 'text'}">
								{{stockBreak.dealerName | capitalize:true}}
							</td>
							<td data-title="'Tienda'" sortable="'storeName'" filter="{'storeName':'text'}">
								{{stockBreak.storeName | capitalize:true}}
							</td>
							<td data-title="'EAN'" sortable="'ean'" filter="{'ean': 'text'}">
								{{stockBreak.ean}}
							</td>
							<td data-title="'Descripción'" sortable="'description'" filter="{'description': 'text'}">
								{{stockBreak.description | capitalize:true}}
							</td>
							<td data-title="'Categoría'" sortable="'category'" filter="{'category': 'text'}">
								{{stockBreak.category | capitalize:true}}
							</td>
							<td data-title="'Plataforma'" sortable="'platform'" filter="{'platform': 'text'}">
								{{stockBreak.platform}}
							</td>
							<td data-title="'Publisher'" sortable="'publisher'" filter="{'publisher': 'text'}">
								{{stockBreak.publisher}}
							</td>
							<td data-title="'Stock Unidades'" sortable="'units'" filter="{'units': 'text'}">
								{{stockBreak.units | currency:'':0}}
							</td>
							
						</tr>
					</table>
					<h3 class="text-orange-ps text-center" ng-show="!page.stock.stockBreaks.tableParams.data.length">No se encontraron datos</h3>
				</div>
			</section>
		</div>
	</div>

	<div class="row">
		<div class="col-md-12">
			<section class="tile" fullscreen="isFullscreen01">
				<div class="tile-header dvd dvd-btm">
					<h1 class="custom-font"><strong>Productos de Alta Rotación</strong></h1>
				</div>
				<div class="tile-widget">
					<table ng-table="page.stock.topProducts.tableParams" show-filter="true" class="table table-custom">
						<tr ng-repeat="topProduct in page.stock.topProducts.tableParams.data" ng-show="page.stock.topProducts.tableParams.data.length">
							<td data-title="'Dealer'" sortable="'dealerName'" filter="{'dealerName':'text'}">
								{{topProduct.dealerName | capitalize:true}}
							</td>
							<td data-title="'Tienda'" sortable="'store'" filter="{'store':'text'}">
								{{topProduct.storeName | capitalize:true}}
							</td>
							<td data-title="'EAN'" sortable="'storeName'" filter="{'storeName':'text'}">
								{{topProduct.ean}}
							</td>
							<td data-title="'Descripción'" sortable="'description'" filter="{'description': 'text'}">
								{{topProduct.description | capitalize:true}}
							</td>
							<td data-title="'Categoría'" sortable="'category'" filter="{'category': 'text'}">
								{{topProduct.category | capitalize:true}}
							</td>
							<td data-title="'Plataforma'" sortable="'platform'" filter="{'platform': 'text'}">
								{{topProduct.platform}}
							</td>
							<td data-title="'Publisher'" sortable="'publisher'" filter="{'publisher': 'text'}">
								{{topProduct.publisher}}
							</td>
							<td data-title="'Unidades Vendidas'" sortable="'units'" filter="{'units': 'text'}">
								{{topProduct.units | currency:'':0}}
							</td>
						</tr>
					</table>
					<h3 class="text-orange-ps text-center" ng-show="!page.stock.topProducts.tableParams.data.length">No se encontraron datos</h3>
				</div>
			</section>
		</div>
	</div>

	<div class="row">
		<div class="col-md-4" ng-repeat="graph in page.stock.graficos">
			<section class="tile" fullscreen="isFullscreen01">
				<div class="tile-header dvd dvd-btm">
					<h1 class="custom-font"><strong> {{graph[0].name}} </strong></h1>
				</div>
				<div class="tile-widget">
					<highchart config="graph[0].grafico"></highchart>
				</div>
			</section>
		</div>
	</div>

	<div class="row">
		<div class="col-md-6">
			<section class="tile" >
				<div class="tile-header dvd dvd-btm">
					<h1 class="custom-font"><strong>Stock valorizado </strong></h1>
				</div>
				<div class="tile-widget">
					<highchart config="charValueStock"></highchart>
				</div>
			</section>
		</div>
		<div class="col-md-6">
			<section class="tile">
				<div class="tile-header dvd dvd-btm">
					<h2 class="custom-font"><strong>Share de Stock</strong></h2>
				</div>
				<div class="tile-widget">
					<div morris-donut-chart donut-data='donutData' style="height: 513px" data-formatter="$"></div>
				</div>
			</section>
		</div>
	</div>
</div>

<script type="text/ng-template" id="messageModal.html">
	<div class="modal-header text-gray">
		<h3 class="text-center">{{modal.title}}</h3>
	</div>
	<div class="modal-body text-center">
		<h4>{{modal.text}}</h4>
	</div>
	<div class="modal-footer">
		<button class="btn btn-default btn-rounded-10 mb-10" type="button" ng-click="cancel()">Cerrar</button>
	</div>
</script>

<script type="text/ng-template" id="newStock.html">
	<div class="overlay br-30" ng-show="modal.overlay.show">
		<div style="position:absolute;top: 50%;left:50%;transform: translate(-50%, -50%);">
			<div>
				<p><strong>Subiendo el archivo...</strong></p>
				<p class="text-center">
					<img src="images/loader.gif" alt="loader" class="size-45x45">
				</p>
			</div>
		</div>
	</div>

	<div class="modal-header text-gray" id="topModalNewMonthlyGoal">
		<h3 class="text-center">{{modal.title.text}} {{modal.subtitle.text}}</h3>
	</div>
	<div class="modal-body text-gray">

		<div class="alert alert-{{modal.alert.color}}" ng-show="modal.alert.show"> <h4 class="text-md"><strong>{{modal.alert.title}}</strong></h4> {{modal.alert.text}} </div>
		
		<div class="row">
			<div class="col-md-12">
				<form class="form-horizontal" role="form">
					<div class="form-group">
						<label class="col-sm-3 control-label">Mes</label>
						<div class="col-sm-8">
							<p class="input-group">
								<input type="text" class="form-control" uib-datepicker-popup="MM/yyyy" ng-model="modal.monthlyGoal.date.value" is-open="modal.datepicker.opened" datepicker-options="{minMode: 'month', showButtonBar: false}" />
								<span class="input-group-btn">
									<button type="button" class="btn btn-default" ng-click="openDatePicker($event)"><i class="glyphicon glyphicon-calendar"></i></button>
								</span>
							</p>
						</div>
					</div>
					<div class="form-group">
						<label class="col-sm-3 control-label">Archivo</label>
						<div class="col-sm-8">
							<input class="form-control" type="file" file-model="modal.monthlyGoal.file.value" ng-disabled="" accept=".xls,.xlsx,.csv,.txt" ng-model="modal.monthlyGoal.file.value" ng-change="removeAlert()" valid-file required>
						</div>
					</div>
				</form>
			</div>
		</div>
	</div>
	<div class="modal-footer">
		<button class="btn btn-success btn-rounded-10 mb-10" ng-class="{'btn-border': modal.buttons.create.border}" type="button" ng-show="modal.buttons.create.show" ng-click="createMonthlyGoal({success: true,detail: 'OK'})" >{{modal.buttons.create.text}}</button>

		<button class="btn btn-warning btn-rounded-10 mb-10" ng-class="{'btn-border': modal.buttons.edit.border}" type="button" ng-show="modal.buttons.edit.show" ng-click="editStockBreIngresarak({success: true,detail: 'OK'})" >{{modal.buttons.edit.text}}</button>

		<button class="btn btn-danger btn-rounded-10 mb-10" ng-class="{'btn-border': modal.buttons.delete.border}" type="button" ng-show="modal.buttons.delete.show" ng-click="deleteStockBreak({success: true,detail: 'OK'})" >{{modal.buttons.delete.text}}</button>

		<button class="btn btn-cancelRecit btn-rounded-10 mb-10" type="button" ng-click="cancel()">Cerrar</button>
	</div>
</script>

<script type="text/ng-template" id="summaryLoadMonthlyGoal.html">
	<div class="modal-header text-gray" id="topModalSummaryLoadMonthlyGoal">
		<h3 class="text-center">{{modal.title.text}} {{modal.subtitle.text}}</h3>
	</div>
	<div class="modal-body text-gray">

		<div class="alert alert-{{modal.alert.color}}" ng-show="modal.alert.show"> <h4 class="text-md"><strong>{{modal.alert.title}}</strong></h4> {{modal.alert.text}} </div>
		
		<div class="row">
			<div class="col-md-12">

				<h4 class="text-center text-success">Éxitos - <b> {{modal.successes.count}}</b> metas insertadas</h4>
				<ul class="list-inline">
					<!-- Si el elemento no es el último, se escribe con una coma al final -->
					<li class="list-inline-item" ng-repeat="success in modal.successes.data" ng-if="!$last">{{success.storeCode}},</li>
					<!-- Si el elemento es el ultimo, se escribe, sin una coma al final  -->
					<li class="list-inline-item" ng-repeat="success in modal.successes.data" ng-if="$last">{{success.storeCode}}</li>
				</ul>
				<hr>

				<h4 class="text-center text-danger">Errores - <b>{{modal.errors.count}}</b> metas con error</h4>
				<table class="table table-hover" ng-show="modal.errors.data.length">
					<thead>
						<tr>
							<th>Fila</th>
							<th>Campo</th>
							<th>Descripción</th>
						</tr>Ingresar
					</thead>
					<tbody ng-repeat="error in modal.errors.data">
						<tr>
							<td>{{error.rowNumber}}</td>
							<!-- Si hay un error de codigo de store, se muestra -->
							<td ng-if="error.fields[0].name">{{error.fields[0].name}}</td>
							<td ng-if="error.fields[0].detail">{{error.fields[0].detail}}</td>
							
							<!-- si no hay un error de codigo de store, se muestra el error de monto -->
							<td ng-if="!error.fields[0].name">{{error.fields[1].name}}</td>
							<td ng-if="!error.fields[0].detail">{{error.fields[1].detail}}</td>
						</tr>
					</tbody>
				</table>
			</div>
		</div>
	</div>
	<div class="modal-footer">

		<button class="btn btn-cancelRecit btn-rounded-10 mb-10" type="button" ng-click="cancel()">Cerrar</button>
	</div>
</script>